
# AI-Powered SQL Agent

This project implements an intelligent LangChain SQL Agent capable of interacting with PostgreSQL databases using natural language. It supports multiple LLM providers (Groq, OpenRouter) and can dynamically adapt to different database schemas (e.g., Bike Store, Massive Bank).

## Features

*   **Natural Language to SQL**: Converts user questions into SQL queries.
*   **Multi-Provider Support**: Works with Groq (Llama 3) and OpenRouter (GPT/Gemini).
*   **Database Agnostic**: Can connect to Postgres, MySQL, SQLite, and MSSQL.
*   **Smart Schema Injection**: Automatically detects the active database and injects curated metadata (if available) or dynamically inspects the schema.
*   **Data Embedding**: Scripts to easily upload CSV or Excel data into your Postgres database.
*   **Logging**: Records all queries, generated SQL, and answers to `query_history.txt`.
*   **Memory**: Maintains conversation context for follow-up questions.

## Project Structure

*   `agents/`
    *   `database_generic_groq.py`: Main agent implementation using Groq (Llama 3 70B). Supports curated metadata.
    *   `database_generic_or.py`: Agent implementation using OpenRouter.
*   `schema_metadata.py`: Contains curated descriptions for specific databases (`bike_store`, `massive-bank`) to improve LLM accuracy.
*   `data_embedder.py`: Utility to upload Excel (`.xlsx`) files to Postgres (`massive-bank`).
*   `data_embedder_csv.py`: Utility to upload CSV files to Postgres (`bike_store`).
*   `requirements.txt`: Python dependencies.

## Setup

1.  **Install Dependencies**:
    ```bash
    pipenv install -r requirements.txt
    pipenv shell
    ```

2.  **Environment Variables**:
    Create a `.env` file with your credentials:
    ```env
    # Database Config
    DB_USER=postgres
    DB_PASSWORD=your_password
    DB_HOST=localhost
    DB_PORT=5432
    DB_NAME=massive-bank  # or bike_store
    DB_TYPE=postgres

    # API Keys
    GROQ_API_KEY=gsk_...
    OPENROUTER_API_KEY=sk-or-....
    LLM_MODEL=llama-3.3-70b-versatile  # or google/gemini-2.0-flash-exp:free
    ```

3.  **Load Data**:
    *   For Bike Store (CSVs):
        ```bash
        python data_embedder_csv.py
        ```
    *   For Massive Bank (Excel):
        ```bash
        python data_embedder.py
        ```

## Usage

Run the agent:

```bash
python agents/database_generic_groq.py
```

**Example Questions:**
*   "What is the total revenue generated by each store?" (Bike Store)
*   "What is the average transaction value for every city over the year?" (Massive Bank)
